webpackJsonp([1,2],{29:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n(72),i=n(68),s=n.n(i);new a.a({el:"#app",render:function(t){return t(s.a)}})},30:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n(33),i=n.n(a),s=n(32),o=n.n(s),r=n(34),d=n.n(r),l=n(66),u=n.n(l),c=n(67),v=n.n(c);e.default={ctx:null,img:null,data:function(){return{regionId:1,segIdGen:0,poiIdGen:0,cpIdGen:0,isAddCoords:!1,isAddPOI:!1,isAddCP:!1,currentSeg:null,segments:[],cps:[],pois:[],results:"",autoSave:null}},mounted:function(){var t=localStorage.getItem("results"),e=localStorage.getItem("regionId");e&&(this.regionId=+e),t&&this.parse(t),this.loadImg(this.regionId),this.autoSave=setInterval(this.saveData,1e3)},destroyed:function(){clearInterval(this.autoSave)},methods:{parse:function(t){var e=JSON.parse(t);this.segments=e.segs||[],this.pois=e.pois||[],this.cps=e.cps||[];var n=!0,a=!1,i=void 0;try{for(var s,r=o()(this.segments);!(n=(s=r.next()).done);n=!0){var l=s.value;l.coords=l.coords.map(function(t){return[t.utm_lon,t.utm_lat]})}}catch(t){a=!0,i=t}finally{try{!n&&r.return&&r.return()}finally{if(a)throw i}}this.poiIdGen=Math.max.apply(Math,d()(this.pois.map(function(t){return t.id}))),this.segIdGen=Math.max.apply(Math,d()(this.segments.map(function(t){return t.id}))),this.cpIdGen=Math.max.apply(Math,d()(this.cps.map(function(t){return t.id})))},loadImg:function(t){var e=this,n=this.$refs.canvas.getContext("2d"),a=this.$refs.roads.getContext("2d"),i=new Image;i.onload=function(){n.canvas.height=i.height,n.canvas.width=i.width,a.canvas.height=i.height,a.canvas.width=i.width,n.drawImage(i,0,0,n.canvas.width,n.canvas.height),a.beginPath(),a.moveTo(0,0),a.lineTo(200,200),a.stroke(),e.drawRoads()},i.src=1===t?u.a:v.a,this.regionId=t,this.ctx=a,this.img=i},loadSegs:function(t){var e=this,n=t.target.files[0],a=new FileReader;a.onload=function(t){e.parse(t.target.result),e.drawRoads()},a.readAsText(n)},clickCanvas:function(t){if(!t.ctrlKey)if(this.isAddCoords)this.currentSeg.coords.push([t.offsetX,t.offsetY]),this.drawRoads();else if(this.isAddPOI){var e={id:this.poiIdGen++,Name:"No name",Type:"No type",utm_lat:t.offsetY,utm_lon:t.offsetX};this.pois.push(e),this.drawRoads()}else if(this.isAddCP){var n={id:this.cpIdGen++,quantity:700,r:10,utm_lat:t.offsetY,utm_lon:t.offsetX};this.cps.push(n),this.drawRoads()}},cleanState:function(){this.isAddCoords=!1,this.isAddPOI=!1,this.isAddCP=!1,this.currentSeg=null},rightClickCanvas:function(t){t.preventDefault(),this.cleanState()},addSegment:function(){var t={id:this.segIdGen++,name:"No name",velocity:0,quantity:0,width:2,coords:[]};this.segments.push(t),this.cleanState(),this.currentSeg=t,this.isAddCoords=!0},addCoords:function(t,e){this.cleanState(),this.isAddCoords=!0,this.currentSeg=t},addPOI:function(){this.cleanState(),this.isAddPOI=!0},addCP:function(){this.cleanState(),this.isAddCP=!0},removePOI:function(t){this.pois.splice(t,1)},removeCP:function(t){this.cps.splice(t,1)},removeCoords:function(t){(t||this.currentSeg).coords.pop(),this.drawRoads()},saveData:function(t){var e=JSON.parse(i()(this.segments)),n=!0,a=!1,s=void 0;try{for(var r,d=o()(e);!(n=(r=d.next()).done);n=!0){var l=r.value;l.coords=l.coords.map(function(t){return{utm_lat:t[1],utm_lon:t[0]}})}}catch(t){a=!0,s=t}finally{try{!n&&d.return&&d.return()}finally{if(a)throw s}}e=i()({pois:this.pois,cps:this.cps,segs:e}),localStorage.setItem("regionId",this.regionId),localStorage.setItem("results",e),null===t&&(this.results=e)},drawRoads:function(){var t=this.ctx;t.clearRect(0,0,t.canvas.width,t.canvas.height);var e=!0,n=!1,a=void 0;try{for(var i,s=o()(this.segments);!(e=(i=s.next()).done);e=!0){var r=i.value;if(r.coords[0]){t.beginPath(),t.moveTo(r.coords[0][0],r.coords[0][1]);for(var d=1,l=r.coords.length;d<l;++d){var u=r.coords[d];t.lineTo(u[0],u[1])}t.lineWidth=r.width,t.stroke()}}}catch(t){n=!0,a=t}finally{try{!e&&s.return&&s.return()}finally{if(n)throw a}}var c=2*Math.PI;t.fillStyle="green";var v=!0,p=!1,m=void 0;try{for(var h,g=o()(this.pois);!(v=(h=g.next()).done);v=!0){var _=h.value;t.beginPath(),_&&t.arc(_.utm_lon,_.utm_lat,3,0,c,!1),t.fill()}}catch(t){p=!0,m=t}finally{try{!v&&g.return&&g.return()}finally{if(p)throw m}}var f=!0,y=!1,x=void 0;try{for(var w,C=o()(this.cps);!(f=(w=C.next()).done);f=!0){var P=w.value;t.beginPath(),t.fillStyle="rgba(52, 152, 219, "+P.quantity/1e3+")",P&&t.arc(P.utm_lon,P.utm_lat,P.r,0,c,!1),t.fill()}}catch(t){y=!0,x=t}finally{try{!f&&C.return&&C.return()}finally{if(y)throw x}}},cleanCache:function(){this.pois=[],this.segments=[],this.cps=[],this.drawRoads()}}}},65:function(t,e){},66:function(t,e,n){t.exports=n.p+"static/image/region1.921b154.png"},67:function(t,e,n){t.exports=n.p+"static/image/region2.7d54efe.png"},68:function(t,e,n){n(65);var a=n(69)(n(30),n(70),null,null);t.exports=a.exports},70:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("section",{staticClass:"tools"},[n("button",{on:{click:function(e){t.loadImg(1)}}},[t._v("Region1")]),t._v(" "),n("button",{on:{click:function(e){t.loadImg(2)}}},[t._v("Region2")]),t._v(" "),n("input",{attrs:{type:"file",name:"img"},on:{change:t.loadSegs}}),t._v(" "),n("button",{on:{click:t.addSegment}},[t._v("Add Segment")]),t._v(" "),n("button",{on:{click:t.addPOI}},[t._v("Add POI")]),t._v(" "),n("button",{on:{click:t.addCP}},[t._v("Add Cellphone")]),t._v(" "),n("button",{on:{click:function(e){t.saveData(null)}}},[t._v("Save")]),t._v(" "),n("button",{on:{click:t.cleanCache}},[t._v("Clean Cache")]),t._v(" "),n("button",{on:{click:t.drawRoads}},[t._v("Refresh ")])]),t._v(" "),n("section",{staticClass:"main",on:{click:function(e){if(!e.ctrlKey)return null;t.removeCoords(null)}}},[n("div",{staticClass:"map"},[n("canvas",{ref:"canvas"}),t._v(" "),n("canvas",{ref:"roads",staticClass:"roads",class:{add:t.isAddCoords||t.isAddPOI||t.isAddCP},on:{click:t.clickCanvas,contextmenu:t.rightClickCanvas}})]),t._v(" "),n("div",{staticClass:"editor"},[t._l(t.segments,function(e){return n("div",{staticClass:"seg",class:{current:e===t.currentSeg}},[n("span",[t._v("id:")]),t._v(" "),n("span",[t._v(t._s(e.id))]),t._v(" "),n("span",[t._v("name:")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"seg.name"}],attrs:{type:"text"},domProps:{value:e.name},on:{input:function(t){t.target.composing||(e.name=t.target.value)}}}),t._v(" "),n("span",[t._v("velocity")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.velocity,expression:"seg.velocity"}],attrs:{type:"text"},domProps:{value:e.velocity},on:{input:function(t){t.target.composing||(e.velocity=t.target.value)}}}),t._v(" "),n("span",[t._v("quantity")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.quantity,expression:"seg.quantity"}],attrs:{type:"text"},domProps:{value:e.quantity},on:{input:function(t){t.target.composing||(e.quantity=t.target.value)}}}),t._v(" "),n("span",[t._v("width")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.width,expression:"seg.width"}],attrs:{type:"text"},domProps:{value:e.width},on:{input:function(t){t.target.composing||(e.width=t.target.value)}}}),t._v(" "),n("button",{attrs:{tabindex:"-1"},on:{click:function(n){t.addCoords(e,n)}}},[t._v("Add Coords")]),t._v(" "),n("button",{attrs:{tabindex:"-1"},on:{click:function(n){t.removeCoords(e)}}},[t._v("Remove Coords")]),t._v(" "),n("div",{staticClass:"coords"},t._l(e.coords,function(a,i){return n("div",[n("span",[t._v(t._s("#"+i+":"))]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.coords[i],expression:"seg.coords[idx]"}],attrs:{tabindex:"-1",type:"text"},domProps:{value:e.coords[i]},on:{input:function(t){if(!t.target.composing){var n=e.coords,a=i;Array.isArray(n)?n.splice(a,1,t.target.value):e.coords[i]=t.target.value}}}})])}))])}),t._v(" "),t._l(t.pois,function(e,a){return n("div",{staticClass:"poi",class:{}},[n("span",[t._v("id:")]),t._v(" "),n("span",[t._v(t._s(e.id))]),t._v(" "),n("span",[t._v("name:")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.Name,expression:"poi.Name"}],attrs:{type:"text"},domProps:{value:e.Name},on:{input:function(t){t.target.composing||(e.Name=t.target.value)}}}),t._v(" "),n("span",[t._v("TYPE")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.Type,expression:"poi.Type"}],attrs:{type:"text"},domProps:{value:e.Type},on:{input:function(t){t.target.composing||(e.Type=t.target.value)}}}),t._v(" "),n("span",[t._v("X")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.utm_lat,expression:"poi.utm_lat"}],attrs:{tabindex:"-1",type:"text"},domProps:{value:e.utm_lat},on:{input:function(t){t.target.composing||(e.utm_lat=t.target.value)}}}),t._v(" "),n("span",[t._v("Y")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.utm_lon,expression:"poi.utm_lon"}],attrs:{tabindex:"-1",type:"text"},domProps:{value:e.utm_lon},on:{input:function(t){t.target.composing||(e.utm_lon=t.target.value)}}}),t._v(" "),n("button",{attrs:{tabindex:"-1"},on:{click:function(e){t.removePOI(a)}}},[t._v("Remove")])])}),t._v(" "),t._l(t.cps,function(e,a){return n("div",{staticClass:"cp",class:{}},[n("span",[t._v("id:")]),t._v(" "),n("span",[t._v(t._s(e.id))]),t._v(" "),n("span",[t._v("Radius")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.r,expression:"cp.r"}],attrs:{type:"text"},domProps:{value:e.r},on:{input:[function(t){t.target.composing||(e.r=t.target.value)},t.drawRoads]}}),t._v(" "),n("span",[t._v("Value")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.quantity,expression:"cp.quantity"}],attrs:{type:"text"},domProps:{value:e.quantity},on:{input:[function(t){t.target.composing||(e.quantity=t.target.value)},t.drawRoads]}}),t._v(" "),n("span",[t._v("X")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.utm_lat,expression:"cp.utm_lat"}],attrs:{tabindex:"-1",type:"text"},domProps:{value:e.utm_lat},on:{input:function(t){t.target.composing||(e.utm_lat=t.target.value)}}}),t._v(" "),n("span",[t._v("Y")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.utm_lon,expression:"cp.utm_lon"}],attrs:{tabindex:"-1",type:"text"},domProps:{value:e.utm_lon},on:{input:function(t){t.target.composing||(e.utm_lon=t.target.value)}}}),t._v(" "),n("button",{attrs:{tabindex:"-1"},on:{click:function(e){t.removeCP(a)}}},[t._v("Remove")])])})],2),t._v(" "),n("div",[n("span",[t._v(t._s(t.results))])])])])},staticRenderFns:[]}},74:function(t,e,n){t.exports=n(29)}},[74]);