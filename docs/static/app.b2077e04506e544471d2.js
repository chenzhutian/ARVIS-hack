webpackJsonp([1,2],{29:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(72),a=n(68),s=n.n(a);new o.a({el:"#app",render:function(t){return t(s.a)}})},30:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(33),a=n.n(o),s=n(32),i=n.n(s),r=n(34),d=n.n(r),l=n(66),c=n.n(l),u=n(67),v=n.n(u);e.default={ctx:null,img:null,data:function(){return{regionId:1,segIdGen:0,poiIdGen:0,isAddCoords:!1,isAddPOI:!1,currentSeg:null,segments:[],results:"",pois:[],poiResults:"",autoSave:null}},mounted:function(){var t=localStorage.getItem("results"),e=localStorage.getItem("regionId");if(e&&(this.regionId=+e),t){var n=JSON.parse(t);this.segments=n.segs||[],this.pois=n.pois||[];var o=!0,a=!1,s=void 0;try{for(var r,l=i()(this.segments);!(o=(r=l.next()).done);o=!0){var c=r.value;c.coords=c.coords.map(function(t){return[t.utm_lon,t.utm_lat]})}}catch(t){a=!0,s=t}finally{try{!o&&l.return&&l.return()}finally{if(a)throw s}}this.poiIdGen=Math.max.apply(Math,d()(this.pois.map(function(t){return t.id}))),this.segIdGen=Math.max.apply(Math,d()(this.segments.map(function(t){return t.id})))}this.loadImg(this.regionId),this.autoSave=setInterval(this.saveData,1e3)},destroyed:function(){clearInterval(this.autoSave)},methods:{loadImg:function(t){var e=this,n=this.$refs.canvas.getContext("2d"),o=this.$refs.roads.getContext("2d"),a=new Image;a.onload=function(){n.canvas.height=a.height,n.canvas.width=a.width,o.canvas.height=a.height,o.canvas.width=a.width,n.drawImage(a,0,0,n.canvas.width,n.canvas.height),o.beginPath(),o.moveTo(0,0),o.lineTo(200,200),o.stroke(),e.drawRoads()},a.src=1===t?c.a:v.a,this.regionId=t,this.ctx=o,this.img=a},loadSegs:function(t){var e=this,n=t.target.files[0],o=new FileReader;o.onload=function(t){var n=JSON.parse(t.target.result);e.segments=n.segs||[],e.pois=n.pois||[];var o=!0,a=!1,s=void 0;try{for(var r,d=i()(e.segments);!(o=(r=d.next()).done);o=!0){var l=r.value;l.coords=l.coords.map(function(t){return[t.utm_lon,t.utm_lat]})}}catch(t){a=!0,s=t}finally{try{!o&&d.return&&d.return()}finally{if(a)throw s}}e.drawRoads()},o.readAsText(n)},clickCanvas:function(t){if(!t.ctrlKey)if(this.isAddCoords)this.currentSeg.coords.push([t.offsetX,t.offsetY]),this.drawRoads();else if(this.isAddPOI){var e={id:this.poiIdGen++,Name:"No name",Type:"No type",utm_lat:t.offsetY,utm_lon:t.offsetX};this.pois.push(e),this.drawRoads()}},cleanState:function(){this.isAddCoords=!1,this.isAddPOI=!1,this.currentSeg=null},rightClickCanvas:function(t){t.preventDefault(),this.cleanState()},addSegment:function(){var t={id:this.segIdGen++,name:"No name",velocity:0,quantity:0,width:2,coords:[]};this.segments.push(t),this.cleanState(),this.currentSeg=t,this.isAddCoords=!0},addCoords:function(t,e){this.cleanState(),this.isAddCoords=!0,this.currentSeg=t},addPOI:function(){this.cleanState(),this.isAddPOI=!0},removePOI:function(t){this.pois.splice(t,1)},removeCoords:function(t){(t||this.currentSeg).coords.pop(),this.drawRoads()},saveData:function(t){var e=JSON.parse(a()(this.segments)),n=!0,o=!1,s=void 0;try{for(var r,d=i()(e);!(n=(r=d.next()).done);n=!0){var l=r.value;l.coords=l.coords.map(function(t){return{utm_lat:t[1],utm_lon:t[0]}})}}catch(t){o=!0,s=t}finally{try{!n&&d.return&&d.return()}finally{if(o)throw s}}e=a()({pois:this.pois,segs:e}),localStorage.setItem("regionId",this.regionId),localStorage.setItem("results",e),null===t&&(this.results=e)},drawRoads:function(){var t=this.ctx;t.clearRect(0,0,t.canvas.width,t.canvas.height);var e=!0,n=!1,o=void 0;try{for(var a,s=i()(this.segments);!(e=(a=s.next()).done);e=!0){var r=a.value;if(r.coords[0]){t.beginPath(),t.moveTo(r.coords[0][0],r.coords[0][1]);for(var d=1,l=r.coords.length;d<l;++d){var c=r.coords[d];t.lineTo(c[0],c[1])}t.lineWidth=r.width,t.stroke()}}}catch(t){n=!0,o=t}finally{try{!e&&s.return&&s.return()}finally{if(n)throw o}}var u=2*Math.PI;t.fillStyle="green";var v=!0,m=!1,p=void 0;try{for(var g,h=i()(this.pois);!(v=(g=h.next()).done);v=!0){var f=g.value;t.beginPath(),f&&t.arc(f.utm_lon,f.utm_lat,3,0,u,!1),t.fill()}}catch(t){m=!0,p=t}finally{try{!v&&h.return&&h.return()}finally{if(m)throw p}}},cleanCache:function(){this.pois=[],this.segments=[],this.drawRoads()}}}},65:function(t,e){},66:function(t,e,n){t.exports=n.p+"static/image/region1.921b154.png"},67:function(t,e,n){t.exports=n.p+"static/image/region2.7d54efe.png"},68:function(t,e,n){n(65);var o=n(69)(n(30),n(70),null,null);t.exports=o.exports},70:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("section",{staticClass:"tools"},[n("button",{on:{click:function(e){t.loadImg(1)}}},[t._v("Region1")]),t._v(" "),n("button",{on:{click:function(e){t.loadImg(2)}}},[t._v("Region2")]),t._v(" "),n("input",{attrs:{type:"file",name:"img"},on:{change:t.loadSegs}}),t._v(" "),n("button",{on:{click:t.addSegment}},[t._v("Add Segment")]),t._v(" "),n("button",{on:{click:t.addPOI}},[t._v("Add POI")]),t._v(" "),n("button",{on:{click:function(e){t.saveData(null)}}},[t._v("Save")]),t._v(" "),n("button",{on:{click:t.cleanCache}},[t._v("Clean Cache")])]),t._v(" "),n("section",{staticClass:"main",on:{click:function(e){if(!e.ctrlKey)return null;t.removeCoords(null)}}},[n("div",{staticClass:"map"},[n("canvas",{ref:"canvas"}),t._v(" "),n("canvas",{ref:"roads",staticClass:"roads",class:{add:t.isAddCoords||t.isAddPOI},on:{click:t.clickCanvas,contextmenu:t.rightClickCanvas}})]),t._v(" "),n("div",[n("span",[t._v(t._s(t.results))])]),t._v(" "),n("div",{staticClass:"editor"},[t._l(t.segments,function(e){return n("div",{staticClass:"seg",class:{current:e===t.currentSeg}},[n("span",[t._v("id:")]),t._v(" "),n("span",[t._v(t._s(e.id))]),t._v(" "),n("span",[t._v("name:")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"seg.name"}],attrs:{type:"text"},domProps:{value:e.name},on:{input:function(t){t.target.composing||(e.name=t.target.value)}}}),t._v(" "),n("span",[t._v("velocity")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.velocity,expression:"seg.velocity"}],attrs:{type:"text"},domProps:{value:e.velocity},on:{input:function(t){t.target.composing||(e.velocity=t.target.value)}}}),t._v(" "),n("span",[t._v("quantity")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.quantity,expression:"seg.quantity"}],attrs:{type:"text"},domProps:{value:e.quantity},on:{input:function(t){t.target.composing||(e.quantity=t.target.value)}}}),t._v(" "),n("span",[t._v("width")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.width,expression:"seg.width"}],attrs:{type:"text"},domProps:{value:e.width},on:{input:function(t){t.target.composing||(e.width=t.target.value)}}}),t._v(" "),n("button",{on:{click:function(n){t.addCoords(e,n)}}},[t._v("Add Coords")]),t._v(" "),n("button",{on:{click:function(n){t.removeCoords(e)}}},[t._v("Remove Coords")]),t._v(" "),n("div",{staticClass:"coords"},t._l(e.coords,function(o,a){return n("div",[n("span",[t._v(t._s("#"+a+":"))]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.coords[a],expression:"seg.coords[idx]"}],attrs:{type:"text"},domProps:{value:e.coords[a]},on:{input:function(t){if(!t.target.composing){var n=e.coords,o=a;Array.isArray(n)?n.splice(o,1,t.target.value):e.coords[a]=t.target.value}}}})])}))])}),t._v(" "),t._l(t.pois,function(e,o){return n("div",{staticClass:"poi",class:{}},[n("span",[t._v("id:")]),t._v(" "),n("span",[t._v(t._s(e.id))]),t._v(" "),n("span",[t._v("name:")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.Name,expression:"poi.Name"}],attrs:{type:"text"},domProps:{value:e.Name},on:{input:function(t){t.target.composing||(e.Name=t.target.value)}}}),t._v(" "),n("span",[t._v("TYPE")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.Type,expression:"poi.Type"}],attrs:{type:"text"},domProps:{value:e.Type},on:{input:function(t){t.target.composing||(e.Type=t.target.value)}}}),t._v(" "),n("span",[t._v("X")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.utm_lat,expression:"poi.utm_lat"}],attrs:{type:"text"},domProps:{value:e.utm_lat},on:{input:function(t){t.target.composing||(e.utm_lat=t.target.value)}}}),t._v(" "),n("span",[t._v("Y")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.utm_lon,expression:"poi.utm_lon"}],attrs:{type:"text"},domProps:{value:e.utm_lon},on:{input:function(t){t.target.composing||(e.utm_lon=t.target.value)}}}),t._v(" "),n("button",{on:{click:function(e){t.removePOI(o)}}},[t._v("Remove")])])})],2)])])},staticRenderFns:[]}},74:function(t,e,n){t.exports=n(29)}},[74]);